generator client {
  provider     = "prisma-client"
  output       = "../src/generated/prisma"
  moduleFormat = "cjs"
}

datasource db {
  provider = "postgresql"
}

model User {
  id              Int             @id @default(autoincrement())
  email           String          @unique
  name            String?
  clerkUserId         String          @unique
  createdAt DateTime @default(now())
  currentReviews  CurrentReview[]
  reviewHistories ReviewHistory[]
  
}

model Problem {
  number                Int             @id
  title                 String
  slug                  String
  description           String?         @default("")
  topics                String?         @default("")
  difficulty            String
  similarProblemNumbers String?         @default("")
  similarProblemTexts   String?         @default("")
  currentReviews        CurrentReview[]
  reviewHistories       ReviewHistory[]
}

model CurrentReview {
  userId        Int
  problemNumber Int

  // FSRS fields
  difficulty    Float
  due           DateTime
  elapsedDays   Int
  lapses        Int
  lastReview    DateTime?
  learningSteps Int
  reps          Int
  scheduledDays Int
  stability     Float
  state         Int
  
  problem       Problem  @relation(fields: [problemNumber], references: [number])
  user          User     @relation(fields: [userId], references: [id])

  @@id([userId, problemNumber])
  @@index([userId])
  @@index([problemNumber])
}

model ReviewHistory {
  id              Int      @id @default(autoincrement())

  userId          Int
  problemNumber   Int

  rating          Rating
  reviewedAt      DateTime
  comments        String?  @default("")

  // Same FSRS fields as CurrentReview
  difficulty    Float
  due           DateTime
  elapsedDays   Int
  lapses        Int
  lastReview    DateTime?
  learningSteps Int
  reps          Int
  scheduledDays Int
  stability     Float
  state         Int

  problem         Problem  @relation(fields: [problemNumber], references: [number])
  user            User     @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([problemNumber])
  @@index([reviewedAt])
}

enum Rating {
  AGAIN   //1
  HARD    // 2
  GOOD    // 3
  EASY    // 4
}
