generator client {
  provider     = "prisma-client"
  output       = "../src/generated/prisma"
  moduleFormat = "cjs"
}

datasource db {
  provider = "postgresql"
}

model User {
  id              Int             @id @default(autoincrement())
  email           String          @unique
  name            String?
  clerkUserId     String          @unique
  createdAt       DateTime        @default(now())
  currentReviews  CurrentReview[]
  reviewHistories ReviewHistory[]
}

model Problem {
  number                Int             @id
  title                 String
  slug                  String
  description           String?         @default("")
  topics                String?         @default("")
  difficulty            String
  similarProblemNumbers String?         @default("")
  similarProblemTexts   String?         @default("")
  currentReviews        CurrentReview[]
  reviewHistories       ReviewHistory[]
}

model CurrentReview {
  userId        Int
  problemNumber Int
  stability     Float
  difficulty    Float
  elapsedDays   Int
  scheduledDays Int
  reps          Int
  lapses        Int
  learningSteps Int
  state         Int
  lastReview    DateTime?
  due           DateTime
  problem       Problem   @relation(fields: [problemNumber], references: [number])
  user          User      @relation(fields: [userId], references: [id])

  @@id([userId, problemNumber])
  @@index([userId])
  @@index([problemNumber])
}

model ReviewHistory {
  id            Int       @id @default(autoincrement())
  userId        Int
  problemNumber Int
  rating        Rating
  reviewedAt    DateTime
  comments      String?   @default("")
  state         Int
  stability     Float
  difficulty    Float
  elapsedDays   Int
  scheduledDays Int
  learningSteps Int
  due           DateTime
  lapses        Int
  lastReview    DateTime?
  reps          Int
  problem       Problem   @relation(fields: [problemNumber], references: [number])
  user          User      @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([problemNumber])
  @@index([reviewedAt])
}

enum Rating {
  AGAIN
  HARD
  GOOD
  EASY
}
